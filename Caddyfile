{
    order replace after encode
    # Global options
    auto_https disable_redirects
    # 可选: 配置邮箱用于 Let's Encrypt 通知
    email 213193509seu@gmail.com
}

# ACME challenge handling for HTTP
:80 {
root * /var/www/html
file_server
}

# 1. GPT反代服务。
http://chatai.qqyunsd.com {
redir https://{host}{uri} permanent
}

https://chatai.qqyunsd.com {
@notapi {
not path /backend-api/conversation
}

replace @notapi {
"SoruxGPT 登录" "GPT 登录"
"SoruxGPT 账号" "GPT 账号"
"SoruxGPT 密码" "GPT 密码"
"Hello, SoruxGPT!" "Hello, GPT!"
"default-mail@soruxgpt.com" "email"
"SoruxGPT.com User" "User"
"Powered By SoruxGPT" "Powered By GPT"
"前往 SoruxGPT 注册" "前往 GPT 注册"
}

reverse_proxy https://soruxgpt-saas-liuli.soruxgpt.com {
    header_up Host soruxgpt-saas-liuli.soruxgpt.com
    header_up myhost {http.request.host}
    header_up Accept-Encoding identity  # 禁用上游服务器的压缩
}

}


# 2. shop反代服务。
http://ai.liuligpt.com {
redir https://{host}{uri} permanent
}

https://ai.liuligpt.com {
reverse_proxy {
    to http://52.221.142.198:911
    }
}


http://ailiu.585dg.com {
redir https://{host}{uri} permanent
}

https://ailiu.585dg.com {
reverse_proxy {
    to http://52.221.142.198:911
    }
}


# 3. liulidsj.585dg.com反代服务。
http://liulidsj.585dg.com {
    redir https://{host}{uri} permanent
}

https://liulidsj.585dg.com {
    reverse_proxy {
        to http://52.221.142.198:911
    }
}

# 4. gpthoutai.585dg.com 反代服务。
http://gpthoutai.585dg.com {
    redir https://{host}{uri} permanent
}

https://gpthoutai.585dg.com {
    reverse_proxy {
        to http://panel.soruxgpt.23.158.72.168.nip.io:31295
    }
}


# 5. GPT反代测试服务。
http://chatchangetest.585dg.com {
redir https://{host}{uri} permanent
}

https://chatchangetest.585dg.com {
@notapi {
not path /backend-api/conversation
}

replace @notapi {
"SoruxGPT 登录" "GPT 登录"
"SoruxGPT 账号" "GPT 账号"
"SoruxGPT 密码" "GPT 密码"
"Hello, SoruxGPT!" "Hello, GPT!"
"default-mail@soruxgpt.com" "email"
"SoruxGPT.com User" "User"
"Powered By SoruxGPT" "Powered By GPT"
"前往 SoruxGPT 注册" "前往 GPT 注册"
}

reverse_proxy https://soruxgpt-saas-liuli.soruxgpt.com {
    header_up Host soruxgpt-saas-liuli.soruxgpt.com
    header_up myhost {http.request.host}
    header_up Accept-Encoding identity  # 禁用上游服务器的压缩
}

}


# 6. LobreChat服务。
http://chatpoe.qqyunsd.com {
redir https://{host}{uri} permanent
}

https://chatpoe.qqyunsd.com {

   reverse_proxy {
        to http://52.221.142.198:3080
    }

}


http://drawgpt4o.qqyunsd.com {
  redir https://{host}{uri} permanent
}

https://drawgpt4o.qqyunsd.com {
  # 定义OPTIONS请求的匹配器
  @options {
    method OPTIONS
  }
  
  # 处理OPTIONS预检请求
  handle @options {
    header Access-Control-Allow-Origin "https://www.tikeai.com"
    header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    header Access-Control-Allow-Headers "Content-Type, Authorization"
    header Access-Control-Allow-Credentials "true"
    header Access-Control-Max-Age "3600"
    respond 204
  }
  
  # 为所有其他请求添加CORS头
  handle {
    header Access-Control-Allow-Origin "https://www.tikeai.com"
    header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    header Access-Control-Allow-Headers "Content-Type, Authorization"
    header Access-Control-Allow-Credentials "true"
    
    # 非API路径的反向代理配置
    @notapi {
      not path /backend-api/conversation
    }
    
    reverse_proxy @notapi http://52.221.142.198:5001 {
      header_up Host {host}
      header_up Upgrade {header.Upgrade}
      header_up Connection "upgrade"
      transport http {
        versions h1
      }
    }
  }
}